ISNULL((select SUM(VRD_AmountLocalExVAT - ISNULL(VRD_NetCostLocalFactNoVat, 0.0)) from VRD_CarSaleDetail where VRD_ID_CarSale = VRD_CarSale.ID AND VRD_CarSaleDetType IN (1,3,7,9, 11,13, 14)), 0.0)
 
ISNULL((select SUM(VRD_NetCostLocalFactNoVat) from VRD_CarSaleDetail where VRD_ID_CarSale = VRD_CarSale.ID AND VRD_CarSaleDetType IN (8) AND VRD_AmountLocal = 0.0), 0.0)
 
ISNULL((select SUM(ood.VRD_InvoiceAmountExVAT - CASE WHEN ood.VRD_DetType = 2 THEN 0.0 ELSE ood.VRD_NetCostTotalLocalNoVat END)
from VRD_OutOrderDet ood with(index(IX_VRD_ID_OutOrder))
inner join VRD_OutOrder oo on ood.VRD_ID_OutOrder = oo.ID
INNER JOIN VRD_B_PayMethod pm ON ood.VRD_ID_B_PayMethod = pm.ID
where ood.VRD_ID_OutInvoice IS NOT NULL
  AND oo.VRD_ID_CarSale = VRD_CarSale.ID
  AND ood.VRD_PayType = 1 AND pm.VRD_BMTCarsExtraGear = 0), 0.0)
ISNULL((
SELECT SUM(ccad.VRD_CommissionAmountFact)
FROM VRD_CreditContract cc
INNER JOIN VRD_CreditConActDet ccad ON cc.ID = ccad.VRD_ID_CreditContract
INNER JOIN VRD_CreditConAct cca ON cca.ID = ccad.VRD_ID_CreditConAct
WHERE cc.VRD_ID_CarSale = VRD_CarSale.ID and cca.VRD_Status not in (4)
), 0.0)
ISNULL((
SELECT SUM(iad.VRD_CommissionAmountFact)
FROM VRD_InsuranceActDet iad
INNER JOIN VRD_InsuranceAct ia ON iad.VRD_ID_InsuranceAct = ia.ID
INNER JOIN VRD_InsuranceContract ic ON iad.VRD_ID_InsuranceContract = ic.ID
WHERE ic.VRD_ID_CarSale = VRD_CarSale.ID AND ia.VRD_Status not in (4)
), 0.0)
ISNULL((select SUM(ood.VRD_InvoiceAmountExVAT - CASE WHEN ood.VRD_DetType = 2 THEN 0.0 ELSE ood.VRD_NetCostTotalLocalNoVat END)
from VRD_OutOrderDet ood with(index(IX_VRD_ID_OutOrder))
inner join VRD_OutOrder oo on ood.VRD_ID_OutOrder = oo.ID
INNER JOIN VRD_B_PayMethod pm ON ood.VRD_ID_B_PayMethod = pm.ID
where ood.VRD_ID_OutInvoice IS NOT NULL
  AND (oo.VRD_ID_CarSale = VRD_CarSale.ID OR oo.VRD_ID_CarOrder = VRD_CarSale.VRD_ID_CarOrder OR oo.VRD_ID_UsedCar = VRD_CarSale.VRD_ID_UsedCar)
  AND pm.VRD_BMTCarsExtraGear = 1), 0.0)
ISNULL((
SELECT SUM(csd.VRD_AmountLocalExVAT - ISNULL(csd.VRD_NetCostLocalCalcNoVat, 0.0)) FROM VRD_CarSaleDetail csd
inner join VRD_CarSale cs on csd.VRD_ID_CarSale = cs.ID
inner join VRD_UsedCar uc on cs.VRD_ID_UsedCar = uc.ID
inner join VRD_CarTradeIn cti on uc.ID = cti.VRD_ID_UsedCar
where cti.VRD_ID_CarSale = VRD_CarSale.ID AND csd.VRD_CarSaleDetType IN (1,3,7,9,11,13) AND cs.VRD_Status = 2
ISNULL((select SUM(VRD_AmountLocalExVAT - ISNULL(VRD_NetCostLocalFactNoVat, 0.0)) from VRD_CarSaleDetail where VRD_ID_CarSale = VRD_CarSale.ID AND VRD_CarSaleDetType = 2), 0.0)
-
ISNULL((SELECT SUM(CASE WHEN ood.VRD_DetType in (3,4) THEN ood.VRD_NetCostTotalLocalNoVat ELSE 0.0 END)
FROM VRD_OutOrderDet ood with (index(IX_VRD_ID_OutOrder))
inner join VRD_OutOrder oo on ood.VRD_ID_OutOrder = oo.ID
inner join VRD_B_PayMethod pm ON ood.VRD_ID_B_PayMethod = pm.ID
WHERE
ood.VRD_ID_OutInvoice IS NOT NULL
AND (oo.VRD_ID_CarSale = VRD_CarSale.ID OR oo.VRD_ID_CarOrder = VRD_CarSale.VRD_ID_CarOrder OR oo.VRD_ID_UsedCar = VRD_CarSale.VRD_ID_UsedCar)
AND pm.VRD_BMTCarsPriceAdding = 0
), 0.0)      
)
VRD_PriceDiscountedNV * 100
